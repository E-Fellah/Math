from manim import *
import numpy as np

# --- 1. Global Configuration ---
config.background_color = WHITE 
config.stroke_color = BLACK
config.fill_color = BLACK

class MathProblemSolverTemplate(Scene):
    def construct(self):
        # --- 1. Geometry & Layout Setup ---
        UPPER_FRACTION = 4/5 
        LOWER_FRACTION = 1/5
        total_width = config.frame_width
        total_height = config.frame_height
        upper_height = total_height * UPPER_FRACTION
        lower_height = total_height * LOWER_FRACTION
        upper_box_width = total_width / 2 - 0.1
        
        # Padding & Scaling Factors
        PADDING_FACTOR = 0.95
        NUMBER_FRACTION = 1/8  
        TEXT_FRACTION = 7/8    
        
        # --- UI Containers ---
        bottom_y_center = DOWN * (total_height * (0.5 - LOWER_FRACTION/2))
        upper_y_center = UP * (total_height * (0.5 - UPPER_FRACTION/2))

        # Bottom Left: ID/Counter
        self.bottom_left_box = Rectangle(
            width=(total_width - 0.1) * NUMBER_FRACTION,  
            height=lower_height - 0.1, 
            color=GREEN_A, stroke_color=GREEN_D, fill_opacity=0.1
        ).move_to(bottom_y_center + LEFT * (total_width * (0.5 - NUMBER_FRACTION/2)))
        
        # Bottom Right: Explanation/Commentary
        self.bottom_right_box = Rectangle(
            width=(total_width - 0.1) * TEXT_FRACTION,  
            height=lower_height - 0.1, 
            color=GREEN_A, stroke_color=GREEN_D, fill_opacity=0.05
        ).move_to(bottom_y_center + RIGHT * (total_width * (0.5 - TEXT_FRACTION/2)))
        
        # Top Left: Formula/Input
        self.left_box = Rectangle(
            width=upper_box_width,  height=upper_height - 0.1,   
            color=BLUE_A, stroke_color=BLUE_D, fill_opacity=0.05
        ).move_to(upper_y_center + LEFT * total_width / 4)
        
        # Top Right: Visual/Graph
        self.right_box = Rectangle(
            width=upper_box_width, height=upper_height - 0.1,
            color=RED_A, stroke_color=RED_D, fill_opacity=0.05
        ).move_to(upper_y_center + RIGHT * total_width / 4)

        # Max Dimensions for scaling
        self.max_upper_width = self.left_box.width * PADDING_FACTOR
        self.max_upper_height = self.left_box.height * PADDING_FACTOR
        self.max_comment_width = self.bottom_right_box.width * PADDING_FACTOR
        self.max_comment_height = self.bottom_right_box.height * PADDING_FACTOR

        # --- 2. Logic: Submission or Placeholder ---
        # TO USE: Add your math data here. If empty, the invite will show.
        current_submission = {
            "id": None, # e.g., "1"
            "math_tex": None, # e.g., MathTex(r"x^2=4")
            "visuals": None, # e.g., [Circle(), Dot()]
            "explanation": None # "Step 1: Isolate x."
        }

        if current_submission["math_tex"] is None:
            self.display_invitation()
        else:
            self.display_problem(current_submission)

    def display_invitation(self):
        title = Tex(r"\textbf{Engineering Math Solver}", font_size=50, color=BLACK).shift(UP*0.5)
        invite = Text("Please submit your math problem to populate this template.", 
                      font_size=30, color=DARK_GRAY).next_to(title, DOWN)
        self.play(FadeIn(title), Write(invite))
        self.wait(2)

    def display_problem(self, data):
        # Create Boxes
        self.play(map(Create, [self.left_box, self.right_box, self.bottom_left_box, self.bottom_right_box]))

        # A. ID Box
        id_text = Text(str(data["id"]), color=BLACK, font_size=36).move_to(self.bottom_left_box)
        
        # B. Math Box (Left)
        m_group = VGroup(*data["math_tex"])
        m_group.set_width(self.max_upper_width) if m_group.width > self.max_upper_width else None
        m_group.move_to(self.left_box)

        # C. Visual Box (Right)
        v_group = VGroup(*data["visuals"])
        v_group.set_height(self.max_upper_height) if v_group.height > self.max_upper_height else None
        v_group.move_to(self.right_box)

        # D. Explanation (Bottom Right)
        expl = Paragraph(data["explanation"], color=BLACK, font_size=24)
        expl.set_width(self.max_comment_width) if expl.width > self.max_comment_width else None
        expl.move_to(self.bottom_right_box).align_to(self.bottom_right_box.get_left(), LEFT).shift(RIGHT*0.2)

        self.play(Write(id_text), Write(m_group), Create(v_group), Write(expl))
        self.wait(3)
